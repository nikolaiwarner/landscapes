<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>experiment-0 by nickwarner</title>
    <meta name="description" content="experiment-0">
    <script src="https://aframe.io/releases/0.4.0/aframe.min.js"></script>

    <!-- Shout out to for kickstarting video chromakey for threejs: -->
    <!-- https://github.com/makc/makc.github.io/blob/7fe41693f7bc2d67fb0ebc176124011d86ee0069/three.js/chromakey/index.html -->
    <!-- https://cdn.rawgit.com/hawksley/Threex.chromakey/35df824b/threex.chromakey.js -->

    <script>
    AFRAME.registerShader('chromakey', {
        schema: {
           src: {type: 'map'},
           color: {default: 0x00ff00, type: 'vec3', is: 'uniform'},
           transparent: {default: true}
         },

        vertexShader: [
          "varying mediump vec2 vUv;",
          "void main(void)",
          "{",
            "vUv = uv;",
            "mediump vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",
            "gl_Position = projectionMatrix * mvPosition;",
          "}",
        ].join('\n'),

        fragmentShader: [
          "uniform mediump sampler2D texture;",
          "uniform mediump vec3 color;",
          "varying mediump vec2 vUv;",
          "void main(void)",
          "{",
            "mediump vec3 tColor = texture2D( texture, vUv ).rgb;",
            "mediump float a = (length(tColor - " + "vec3(0.1, 0.9, 0.2)" + ") - 0.5) * 7.0;",  // color
            "gl_FragColor = vec4(tColor, a);",
          "}",
        ].join('\n')
    });

    </script>
</head>
  <body>
    <a-scene>
      <a-assets>
        <video id="chase1" src="chase-green1.mp4" loop autoplay muted />
      </a-assets>

      <!-- Primitives. -->
      <a-entity geometry="primitive: box" material="shader: chromakey; src: #chase1; color: '#0x00ff00'" scale="2 2 2" position="0 1.5 -2" rotation="0 0 0"></a-entity>
      <a-entity geometry="primitive: box" material="src: #chase1;" scale="0.001 0.001 0.001" position="0 1.5 -2" rotation="0 45 0"></a-entity>

      <!-- Background sky. -->
      <a-sky height="2048" radius="30" color="pink" theta-length="90" width="2048"></a-sky>

      <!-- Ground. -->
      <a-circle color="white" rotation="-90 0 0" radius="32"></a-circle>

    </a-scene>
  </body>
</html>
